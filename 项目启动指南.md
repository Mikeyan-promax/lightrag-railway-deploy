# LightRAG 项目启动指南

## 📋 概述

本指南将帮助您正确启动 LightRAG 项目，避免使用错误的环境变量文件，确保系统稳定运行。

## 🗂️ 项目结构说明

您的项目目录结构如下：
```
D:\2\LightRAG-1.4.6\
├── .env                                    # ✅ 当前使用的环境变量文件（生产配置）
├── LightRAG-super-optimized\               # 主要代码目录
│   ├── env.example                         # 环境变量示例文件
│   └── lightrag-server                     # 服务器启动脚本
├── LightRAG-1.4.6\                        # 原始代码目录
└── 其他配置文件...
```

## ⚠️ 重要提醒

### 环境变量文件优先级
1. **系统环境变量** - 最高优先级
2. **当前工作目录的 `.env` 文件** - 中等优先级
3. **默认配置** - 最低优先级

### 当前配置状态
- ✅ **正在使用**: `D:\2\LightRAG-1.4.6\.env` （生产配置，连接阿里云RDS PostgreSQL）
- ⚠️ **避免使用**: 其他目录中的 `.env` 文件或示例文件

## 🚀 正确启动步骤

### 步骤 1: 确认工作目录
```powershell
# 确保在正确的目录中
cd D:\2\LightRAG-1.4.6
```

### 步骤 2: 验证环境变量文件
```powershell
# 检查 .env 文件是否存在
if (Test-Path ".env") {
    Write-Host "✅ .env 文件存在" -ForegroundColor Green
} else {
    Write-Host "❌ .env 文件不存在，需要创建" -ForegroundColor Red
}
```

### 步骤 3: 启动服务器
```powershell
# 方法 1: 使用 Python 模块启动（推荐）
python -m lightrag.api.lightrag_server

# 方法 2: 使用启动脚本
.\LightRAG-super-optimized\lightrag-server

# 方法 3: 直接运行 Python 文件
python .\LightRAG-super-optimized\lightrag\api\lightrag_server.py
```

### 步骤 4: 验证启动成功
```powershell
# 检查服务器健康状态
Invoke-RestMethod -Uri "http://localhost:9621/health" -Method GET
```

## 🔧 环境变量配置说明

### 当前生产配置
您的 `.env` 文件已配置为使用：
- **数据库**: 阿里云RDS PostgreSQL (`pgm-2ze58b40mdfqec4zwo.pg.rds.aliyuncs.com`)
- **端口**: 9621
- **LLM模型**: DeepSeek Chat
- **嵌入模型**: Ollama (本地)

### 关键配置项
```bash
# 服务器配置
HOST=0.0.0.0
PORT=9621

# 数据库配置（PostgreSQL）
KV_STORAGE=postgres
DOCUMENT_STATUS_STORAGE=postgres
GRAPH_STORAGE=postgres
VECTOR_STORAGE=postgres

# PostgreSQL 连接配置
POSTGRES_HOST=pgm-2ze58b40mdfqec4zwo.pg.rds.aliyuncs.com
POSTGRES_PORT=5432
POSTGRES_USER=lightrag_db
POSTGRES_DATABASE=lightrag_production
```

## 🚫 常见错误及避免方法

### 错误 1: 使用错误的环境变量文件
**问题**: 在错误的目录启动或使用示例文件
```powershell
# ❌ 错误做法
cd D:\2\LightRAG-1.4.6\LightRAG-super-optimized
python -m lightrag.api.lightrag_server  # 会使用错误的 .env 文件
```

**解决方案**: 始终在项目根目录启动
```powershell
# ✅ 正确做法
cd D:\2\LightRAG-1.4.6
python -m lightrag.api.lightrag_server
```

### 错误 2: 环境变量冲突
**问题**: 系统环境变量覆盖 `.env` 文件配置

**解决方案**: 清理冲突的系统环境变量
```powershell
# 检查系统环境变量
Get-ChildItem Env: | Where-Object Name -like "*LIGHTRAG*"
Get-ChildItem Env: | Where-Object Name -like "*POSTGRES*"

# 如有冲突，临时清除
Remove-Item Env:POSTGRES_HOST -ErrorAction SilentlyContinue
```

### 错误 3: 端口冲突
**问题**: 端口 9621 被其他进程占用

**解决方案**: 检查并释放端口
```powershell
# 检查端口占用
netstat -ano | findstr :9621

# 如需要，终止占用进程
# taskkill /PID <进程ID> /F
```

## 📝 启动检查清单

在启动前，请确认：

- [ ] 当前工作目录为 `D:\2\LightRAG-1.4.6`
- [ ] `.env` 文件存在且配置正确
- [ ] 端口 9621 未被占用
- [ ] 阿里云RDS PostgreSQL 数据库可访问
- [ ] Python 环境已激活（如使用虚拟环境）

## 🔍 故障排除

### 数据库连接问题
```powershell
# 测试数据库连接
python -c "
import psycopg2
import os
from dotenv import load_dotenv
load_dotenv()
try:
    conn = psycopg2.connect(
        host=os.environ['POSTGRES_HOST'],
        port=os.environ['POSTGRES_PORT'],
        user=os.environ['POSTGRES_USER'],
        password=os.environ['POSTGRES_PASSWORD'],
        database=os.environ['POSTGRES_DATABASE']
    )
    print('✅ 数据库连接成功')
    conn.close()
except Exception as e:
    print(f'❌ 数据库连接失败: {e}')
"
```

### 服务启动问题
```powershell
# 详细日志启动
python -m lightrag.api.lightrag_server --log-level DEBUG
```

## 📞 支持

如遇到问题，请检查：
1. 日志输出中的错误信息
2. 网络连接状态
3. 数据库服务状态
4. 环境变量配置

---

**最后更新**: 2024年12月
**适用版本**: LightRAG 1.4.6